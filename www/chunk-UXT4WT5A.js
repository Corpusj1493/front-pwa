import{a as ie,b as ne}from"./chunk-NZXRBLAM.js";import{c as K,d as Q,e as U,f as j,g as z,h as G,i as X,j as J,k as Y,n as Z,o as $,r as ee,s as te}from"./chunk-I4WRMRUL.js";import{a as oe}from"./chunk-URCPBER3.js";import{a as re}from"./chunk-DADNZVRM.js";import{A as u,Ca as E,Ga as R,H as o,L as f,N as S,Na as V,Oa as N,Qa as A,R as _,W as d,X as i,Y as n,Z as g,da as w,ea as y,fa as M,ja as T,ka as P,l as I,la as L,ma as m,na as x,qa as b,qb as F,ra as C,rb as O,sa as v,sb as W,tb as B,ub as q,va as k,xb as D,z as p,zb as H}from"./chunk-3YJH32OC.js";import"./chunk-Y2PDZ72K.js";import"./chunk-Z6NEOT2M.js";import"./chunk-MSMJJC2X.js";import"./chunk-53OGNGEH.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-REYR55MP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";var se=["captchaRef"],le=()=>["/register"];function ce(r,a){if(r&1&&(i(0,"ion-note",22),m(1),n()),r&2){let ae=M();o(),x(ae.errorMessage)}}function de(r,a){r&1&&g(0,"ion-spinner",23)}function me(r,a){r&1&&(i(0,"span"),m(1,"Iniciar Sesi\xF3n"),n())}var Me=(()=>{let a=class a{constructor(t,s){this.authService=t,this.router=s,this.siteKey=re.recaptchaSiteKey,this.recaptchaToken=null,this.credentials={email:"",password:"",recaptchaToken:""},this.isLoading=!1,this.errorMessage=null}ionViewWillEnter(){localStorage.getItem("auth_token")&&this.router.navigateByUrl("/tabs/tab1",{replaceUrl:!0})}handleRecaptchaSuccess(t){console.log("token recibido.....",t),this.recaptchaToken=t,this.credentials.recaptchaToken=t,console.log("\u2705 reCAPTCHA resuelto.")}handleRecaptchaError(){this.recaptchaToken=null,this.credentials.recaptchaToken="",console.error("\u274C Error en reCAPTCHA. Intente de nuevo."),this.errorMessage="Hubo un problema con la verificaci\xF3n de seguridad."}login(){if(!this.recaptchaToken){this.errorMessage="Por favor, completa la verificaci\xF3n reCAPTCHA.";return}this.isLoading=!0,this.errorMessage=null,this.authService.login(this.credentials).pipe(I(()=>{this.isLoading=!1,this.resetRecaptcha()})).subscribe({next:t=>{t.success&&(console.log("\u2705 LOGIN EXITOSO. Intentando redireccionar a /tab1"),setTimeout(()=>{this.router.navigateByUrl("/tabs/tab1",{replaceUrl:!0})},100))},error:t=>{t.status===401?this.errorMessage="Credenciales inv\xE1lidas. Verifica tu correo y contrase\xF1a.":t.error&&t.error.message?this.errorMessage=t.error.message:this.errorMessage="Ocurri\xF3 un error en el servidor. Int\xE9ntalo de nuevo.",this.resetRecaptcha()}})}resetRecaptcha(){this.captchaRef&&(this.recaptchaToken=null,this.credentials.recaptchaToken="",console.log("\u{1F504} reCAPTCHA reseteado. Requiere nueva interacci\xF3n."))}};a.\u0275fac=function(s){return new(s||a)(f(oe),f(V))},a.\u0275cmp=S({type:a,selectors:[["app-login"]],viewQuery:function(s,e){if(s&1&&T(se,5),s&2){let c;P(c=L())&&(e.captchaRef=c.first)}},decls:33,vars:10,consts:[["captchaRef",""],[3,"translucent"],["color","primary"],[1,"ion-padding","custom-background"],[1,"login-container"],[1,"ion-text-center","ion-margin-bottom"],["name","map-outline","size","large","color","primary"],[1,"modern-card"],[3,"ngSubmit"],["fill","solid","shape","round",1,"ion-margin-bottom"],["name","mail-outline","slot","start","color","medium"],["label","Correo Electr\xF3nico","type","email","labelPlacement","floating","name","email","required","",3,"ngModelChange","ngModel"],["name","lock-closed-outline","slot","start","color","medium"],["label","Contrase\xF1a","type","password","labelPlacement","floating","name","password","required","",3,"ngModelChange","ngModel"],["color","danger","class","ion-padding-start",4,"ngIf"],[1,"ion-padding-vertical","ion-text-center"],["name","g-recaptcha-response",3,"success","error","siteKey"],["expand","block","shape","round","type","submit","color","primary",1,"ion-margin-top",3,"disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-margin-top"],["fill","clear","color","secondary",3,"routerLink"],["color","danger",1,"ion-padding-start"],["name","crescent"]],template:function(s,e){if(s&1){let c=w();i(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-title"),m(3,"Iniciar Sesi\xF3n"),n()()(),i(4,"ion-content",3)(5,"div",4)(6,"div",5),g(7,"ion-icon",6),i(8,"h2"),m(9,"Bienvenido a PWA Reviews"),n(),i(10,"p"),m(11,"Descubre y comparte lugares incre\xEDbles."),n()(),i(12,"ion-card",7)(13,"ion-card-content")(14,"form",8),y("ngSubmit",function(){return p(c),u(e.login())}),i(15,"ion-item",9),g(16,"ion-icon",10),i(17,"ion-input",11),v("ngModelChange",function(l){return p(c),C(e.credentials.email,l)||(e.credentials.email=l),u(l)}),n()(),i(18,"ion-item",9),g(19,"ion-icon",12),i(20,"ion-input",13),v("ngModelChange",function(l){return p(c),C(e.credentials.password,l)||(e.credentials.password=l),u(l)}),n()(),_(21,ce,2,1,"ion-note",14),i(22,"div",15)(23,"ngx-recaptcha2",16,0),y("success",function(l){return p(c),u(e.handleRecaptchaSuccess(l))})("error",function(){return p(c),u(e.handleRecaptchaError())}),n()(),i(25,"ion-button",17),_(26,de,1,0,"ion-spinner",18)(27,me,2,0,"span",19),n()()()(),i(28,"div",20)(29,"ion-label"),m(30,"\xBFNo tienes una cuenta?"),n(),i(31,"ion-button",21),m(32," Reg\xEDstrate aqu\xED "),n()()()()}s&2&&(d("translucent",!0),o(17),b("ngModel",e.credentials.email),o(3),b("ngModel",e.credentials.password),o(),d("ngIf",e.errorMessage),o(2),d("siteKey",e.siteKey),o(2),d("disabled",e.isLoading||!e.recaptchaToken),o(),d("ngIf",e.isLoading),o(),d("ngIf",!e.isLoading),o(4),d("routerLink",k(9,le)))},dependencies:[R,E,H,q,F,O,D,B,W,A,N,ne,ie,z,$,Z,j,ee,Q,U,te,G,J,K,X,Y],styles:[".custom-background[_ngcontent-%COMP%]{--ion-background-color: var(--ion-color-light, #f4f5f8)}.login-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;max-width:450px;margin:0 auto}.modern-card[_ngcontent-%COMP%]{width:100%;box-shadow:0 4px 20px #00000014;border-radius:12px}ion-item[_ngcontent-%COMP%]{--border-radius: 8px;--min-height: 50px;--inner-padding-end: 16px}"]});let r=a;return r})();export{Me as LoginPage};
