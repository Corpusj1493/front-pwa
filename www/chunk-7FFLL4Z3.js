import{a as be,b as ye}from"./chunk-GPOJ6U7F.js";import{a as M,b as S,c as Pe}from"./chunk-HW7KHYNX.js";import{A as me,B as pe,C as ue,D as ge,E as he,G as fe,J as we,K as ve,a as K,b as Q,c as X,e as Y,f as Z,l as $,m as ee,n as te,o as ie,p as ne,q as ae,r as oe,s as re,t as le,v as se,y as ce,z as de}from"./chunk-NZTSZEPZ.js";import"./chunk-DBLGMTO4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-O52IKJVK.js";import"./chunk-OQJCXMAZ.js";import"./chunk-VL6F45B6.js";import"./chunk-EU7FQ5IA.js";import"./chunk-STP2TL6J.js";import"./chunk-TCRGSDKV.js";import"./chunk-7FY2OE2O.js";import"./chunk-VBVQFYTF.js";import"./chunk-5EGKW7JY.js";import"./chunk-DM6TJFWJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-D7QNDGRV.js";import"./chunk-CKP3SGE2.js";import"./chunk-3IBBKVJY.js";import"./chunk-DADNZVRM.js";import{Ca as N,Ga as W,H as p,L as v,N as F,Na as q,R as E,W as h,X as s,Y as c,Z as f,ea as x,fa as D,g as L,l as R,m as T,ma as u,na as U,oa as k,qa as b,qb as B,r as O,ra as y,rb as j,sa as P,sb as G,ta as A,tb as V,ub as H,xb as z,zb as J}from"./chunk-3YJH32OC.js";import"./chunk-Z6NEOT2M.js";import"./chunk-MSMJJC2X.js";import"./chunk-53OGNGEH.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-REYR55MP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as d}from"./chunk-JHI3MBHO.js";var w=(function(o){return o.Prompt="PROMPT",o.Camera="CAMERA",o.Photos="PHOTOS",o})(w||{}),C=(function(o){return o.Rear="REAR",o.Front="FRONT",o})(C||{}),I=(function(o){return o.Uri="uri",o.Base64="base64",o.DataUrl="dataUrl",o})(I||{});var _=class extends Pe{getPhoto(n){return d(this,null,function*(){return new Promise((l,i)=>d(this,null,function*(){if(n.webUseInput||n.source===w.Photos)this.fileInputExperience(n,l,i);else if(n.source===w.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=n.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:n.promptLabelPhoto||"From Photos"},{title:n.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",t=>d(this,null,function*(){t.detail===0?this.fileInputExperience(n,l,i):this.cameraExperience(n,l,i)}))}else this.cameraExperience(n,l,i)}))})}pickImages(n){return d(this,null,function*(){return new Promise((l,i)=>d(this,null,function*(){this.multipleFileInputExperience(l,i)}))})}cameraExperience(n,l,i){return d(this,null,function*(){if(customElements.get("pwa-camera-modal")){let e=document.createElement("pwa-camera-modal");e.facingMode=n.direction===C.Front?"user":"environment",document.body.appendChild(e);try{yield e.componentOnReady(),e.addEventListener("onPhoto",t=>d(this,null,function*(){let r=t.detail;r===null?i(new M("User cancelled photos app")):r instanceof Error?i(r):l(yield this._getCameraPhoto(r,n)),e.dismiss(),document.body.removeChild(e)})),e.present()}catch{this.fileInputExperience(n,l,i)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(n,l,i)})}fileInputExperience(n,l,i){let e=document.querySelector("#_capacitor-camera-input"),t=()=>{var r;(r=e.parentNode)===null||r===void 0||r.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",r=>{let a=e.files[0],m="jpeg";if(a.type==="image/png"?m="png":a.type==="image/gif"&&(m="gif"),n.resultType==="dataUrl"||n.resultType==="base64"){let g=new FileReader;g.addEventListener("load",()=>{if(n.resultType==="dataUrl")l({dataUrl:g.result,format:m});else if(n.resultType==="base64"){let Se=g.result.split(",")[1];l({base64String:Se,format:m})}t()}),g.readAsDataURL(a)}else l({webPath:URL.createObjectURL(a),format:m}),t()}),e.addEventListener("cancel",r=>{i(new M("User cancelled photos app")),t()})),e.accept="image/*",e.capture=!0,n.source===w.Photos||n.source===w.Prompt?e.removeAttribute("capture"):n.direction===C.Front?e.capture="user":n.direction===C.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(n,l){let i=document.querySelector("#_capacitor-camera-input-multiple"),e=()=>{var t;(t=i.parentNode)===null||t===void 0||t.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input-multiple",i.type="file",i.hidden=!0,i.multiple=!0,document.body.appendChild(i),i.addEventListener("change",t=>{let r=[];for(let a=0;a<i.files.length;a++){let m=i.files[a],g="jpeg";m.type==="image/png"?g="png":m.type==="image/gif"&&(g="gif"),r.push({webPath:URL.createObjectURL(m),format:g})}n({photos:r}),e()}),i.addEventListener("cancel",t=>{l(new M("User cancelled photos app")),e()})),i.accept="image/*",i.click()}_getCameraPhoto(n,l){return new Promise((i,e)=>{let t=new FileReader,r=n.type.split("/")[1];l.resultType==="uri"?i({webPath:URL.createObjectURL(n),format:r,saved:!1}):(t.readAsDataURL(n),t.onloadend=()=>{let a=t.result;l.resultType==="dataUrl"?i({dataUrl:a,format:r,saved:!1}):i({base64String:a.split(",")[1],format:r,saved:!1})},t.onerror=a=>{e(a)})})}checkPermissions(){return d(this,null,function*(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}})}requestPermissions(){return d(this,null,function*(){throw this.unimplemented("Not implemented on web.")})}pickLimitedLibraryPhotos(){return d(this,null,function*(){throw this.unavailable("Not implemented on web.")})}getLimitedLibraryPhotos(){return d(this,null,function*(){throw this.unavailable("Not implemented on web.")})}},Ne=new _;var Ce=S("Camera",{web:()=>new _});function Ee(o){o.CapacitorUtils.Synapse=new Proxy({},{get(n,l){return new Proxy({},{get(i,e){return(t,r,a)=>{let m=o.Capacitor.Plugins[l];if(m===void 0){a(new Error(`Capacitor plugin ${l} not found`));return}if(typeof m[e]!="function"){a(new Error(`Method ${e} not found in Capacitor plugin ${l}`));return}d(null,null,function*(){try{let g=yield m[e](t);r(g)}catch(g){a(g)}})}}})}})}function De(o){o.CapacitorUtils.Synapse=new Proxy({},{get(n,l){return o.cordova.plugins[l]}})}function _e(o=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!o?Ee(window):window.cordova!==void 0&&De(window))}var xe=S("Geolocation",{web:()=>import("./chunk-CW7EE3X3.js").then(o=>new o.GeolocationWeb)});_e();var Me=(()=>{let n=class n{constructor(){}takePhoto(){return d(this,null,function*(){return yield Ce.getPhoto({quality:90,allowEditing:!1,resultType:I.Uri,source:w.Prompt,saveToGallery:!1})})}getCurrentPosition(){return d(this,null,function*(){return yield xe.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4})})}};n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=O({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();function Re(o,n){if(o&1&&(s(0,"ion-item"),f(1,"ion-img",28),c()),o&2){let l=D();p(),h("src",l.photoPath)}}function Te(o,n){if(o&1&&(s(0,"ion-item",29)(1,"ion-label",30),u(2),c()()),o&2){let l=D();p(2),U(l.errorMessage)}}function Oe(o,n){o&1&&f(0,"ion-spinner",31)}function Fe(o,n){o&1&&(s(0,"span"),u(1,"Crear Lugar y Enviar Rese\xF1a"),c())}var mt=(()=>{let n=class n{constructor(i,e,t,r,a,m){this.mediaService=i,this.reviewService=e,this.placeService=t,this.router=r,this.alertController=a,this.toastController=m,this.reviewData={name:"",address:"",category:"General",comment:"",rating:3,latitude:null,longitude:null,photo_base64:""},this.photoPath=null,this.isLoading=!1,this.isLocating=!1,this.errorMessage=null}ngOnInit(){this.getCurrentLocation()}readAsBase64(i){return d(this,null,function*(){let t=yield(yield fetch(i.webPath)).blob();return new Promise((r,a)=>{let m=new FileReader;m.onerror=a,m.onload=()=>{let g=m.result.split(",")[1];r(g)},m.readAsDataURL(t)})})}takePhoto(){return d(this,null,function*(){try{this.errorMessage=null;let i=yield this.mediaService.takePhoto();this.photoPath=i.webPath||null;let e=yield this.readAsBase64(i);this.reviewData.photo_base64=e}catch(i){console.error("Error al tomar foto:",i),this.errorMessage="No se pudo acceder a la c\xE1mara o galer\xEDa."}})}getCurrentLocation(){return d(this,null,function*(){this.isLocating=!0,this.errorMessage=null;try{let i=yield this.mediaService.getCurrentPosition();this.reviewData.latitude=i.coords.latitude,this.reviewData.longitude=i.coords.longitude,this.presentToast("Ubicaci\xF3n capturada con \xE9xito.","success")}catch(i){console.error("Error al obtener ubicaci\xF3n:",i),this.errorMessage="No se pudo obtener la ubicaci\xF3n. Verifica los permisos de GPS."}finally{this.isLocating=!1}})}isFormValid(){return!!this.reviewData.name&&!!this.reviewData.comment&&this.reviewData.rating>0&&this.reviewData.latitude!==null&&this.reviewData.longitude!==null}submitReview(){if(!this.isFormValid()){this.presentToast("Por favor, completa los campos requeridos (Nombre, Comentario, Rating y Ubicaci\xF3n).","danger");return}this.isLoading=!0,this.errorMessage=null;let i={name:this.reviewData.name,description:this.reviewData.comment,address:this.reviewData.address||null,lat:this.reviewData.latitude,lng:this.reviewData.longitude,category:this.reviewData.category||null};this.placeService.createPlace(i).pipe(T(e=>{if(!e.success||!e.data?.id)throw new Error(e.message||"Fallo al crear el lugar.");let t=e.data.id,r=this.reviewService.createReview({place_id:t,rating:this.reviewData.rating,comment:this.reviewData.comment});if(this.reviewData.photo_base64){let a=this.reviewService.uploadPhoto({place_id:t,photo:this.reviewData.photo_base64,description:this.reviewData.comment});return L({photo:a,review:r})}else return r}),R(()=>this.isLoading=!1)).subscribe({next:e=>{console.log("Transacci\xF3n completada con \xE9xito:",e),this.presentSuccessAlert(),this.resetForm(),this.router.navigateByUrl("/tabs/tab1",{replaceUrl:!0})},error:e=>{console.error("Error durante la transacci\xF3n:",e);let t=e.error?.message||(e.message.includes("Http failure")?"Error de conexi\xF3n":"Error desconocido");this.errorMessage=t,this.presentToast(`Fallo al guardar: ${t}`,"danger")}})}resetForm(){this.reviewData={name:"",address:"",category:"General",comment:"",rating:3,latitude:null,longitude:null,photo_base64:null},this.photoPath=null}presentSuccessAlert(){return d(this,null,function*(){yield(yield this.alertController.create({header:"\xA1Lugar y Rese\xF1a Creados!",message:"El lugar fue registrado y tu rese\xF1a fue enviada con \xE9xito.",buttons:["OK"]})).present()})}presentToast(i,e){return d(this,null,function*(){(yield this.toastController.create({message:i,duration:2e3,color:e})).present()})}};n.\u0275fac=function(e){return new(e||n)(v(Me),v(be),v(ye),v(q),v(fe),v(we))},n.\u0275cmp=F({type:n,selectors:[["app-create-review"]],decls:65,vars:19,consts:[[3,"translucent"],["slot","start"],["defaultHref","/tabs/tab1"],[3,"fullscreen"],[3,"ngSubmit"],["lines","full",1,"ion-no-margin","ion-no-padding"],["expand","block",3,"click","disabled"],["slot","start","name","locate-outline"],["position","stacked"],["readonly","",3,"value"],["label","Nombre del Lugar (Requerido)","labelPlacement","stacked","type","text","name","name","required","",3,"ngModelChange","ngModel"],["label","Direcci\xF3n (Opcional)","labelPlacement","stacked","type","text","name","address",3,"ngModelChange","ngModel"],["label","Categor\xEDa (Opcional)","labelPlacement","stacked","placeholder","Selecciona una categor\xEDa","name","category",3,"ngModelChange","ngModel"],["value","Restaurante"],["value","Parque"],["value","Tienda"],["value","Museo"],["value","Otro"],["labelPlacement","stacked","min","1","max","5","step","1","color","primary","name","rating",3,"ngModelChange","label","ngModel"],["slot","start","name","star-outline"],["slot","end","name","star"],["label","Comentario (Requerido)","labelPlacement","stacked","rows","4","placeholder","Escribe tu experiencia...","name","comment","required","",3,"ngModelChange","ngModel"],["slot","start","name","camera-outline"],[4,"ngIf"],["color","danger",4,"ngIf"],["lines","none"],["type","submit","expand","block",1,"ion-margin-top",3,"disabled"],["name","crescent",4,"ngIf"],["alt","Foto del lugar",1,"ion-padding",2,"height","200px","object-fit","cover",3,"src"],["color","danger"],[1,"ion-text-wrap"],["name","crescent"]],template:function(e,t){e&1&&(s(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),f(3,"ion-back-button",2),c(),s(4,"ion-title"),u(5,"Nueva Rese\xF1a y Lugar"),c()()(),s(6,"ion-content",3)(7,"form",4),x("ngSubmit",function(){return t.submitReview()}),s(8,"ion-list",5)(9,"ion-list-header")(10,"ion-label"),u(11,"\u{1F4CD} **Ubicaci\xF3n del Lugar**"),c()(),s(12,"ion-item")(13,"ion-button",6),x("click",function(){return t.getCurrentLocation()}),f(14,"ion-icon",7),u(15),c()(),s(16,"ion-item")(17,"ion-label",8),u(18,"Latitud:"),c(),f(19,"ion-input",9),c(),s(20,"ion-item")(21,"ion-label",8),u(22,"Longitud:"),c(),f(23,"ion-input",9),c(),s(24,"ion-list-header")(25,"ion-label"),u(26,"\u{1F5FA}\uFE0F **Detalles del Lugar**"),c()(),s(27,"ion-item")(28,"ion-input",10),P("ngModelChange",function(a){return y(t.reviewData.name,a)||(t.reviewData.name=a),a}),c()(),s(29,"ion-item")(30,"ion-input",11),P("ngModelChange",function(a){return y(t.reviewData.address,a)||(t.reviewData.address=a),a}),c()(),s(31,"ion-item")(32,"ion-select",12),P("ngModelChange",function(a){return y(t.reviewData.category,a)||(t.reviewData.category=a),a}),s(33,"ion-select-option",13),u(34,"Restaurante"),c(),s(35,"ion-select-option",14),u(36,"Parque"),c(),s(37,"ion-select-option",15),u(38,"Tienda"),c(),s(39,"ion-select-option",16),u(40,"Museo"),c(),s(41,"ion-select-option",17),u(42,"Otro"),c()()(),s(43,"ion-list-header")(44,"ion-label"),u(45,"\u2B50 **Tu Rese\xF1a**"),c()(),s(46,"ion-item")(47,"ion-range",18),P("ngModelChange",function(a){return y(t.reviewData.rating,a)||(t.reviewData.rating=a),a}),f(48,"ion-icon",19)(49,"ion-icon",20),c()(),s(50,"ion-item")(51,"ion-textarea",21),P("ngModelChange",function(a){return y(t.reviewData.comment,a)||(t.reviewData.comment=a),a}),c()(),s(52,"ion-list-header")(53,"ion-label"),u(54,"\u{1F4F8} **Foto (Opcional)**"),c()(),s(55,"ion-item")(56,"ion-button",6),x("click",function(){return t.takePhoto()}),f(57,"ion-icon",22),u(58," Tomar/Seleccionar Foto "),c()(),E(59,Re,2,1,"ion-item",23)(60,Te,3,1,"ion-item",24),s(61,"ion-item",25)(62,"ion-button",26),E(63,Oe,1,0,"ion-spinner",27)(64,Fe,2,0,"span",23),c()()()()()),e&2&&(h("translucent",!0),p(6),h("fullscreen",!0),p(7),h("disabled",t.isLocating||t.isLoading),p(2),k(" ",t.isLocating?"Obteniendo...":"Obtener mi Ubicaci\xF3n Actual"," "),p(4),h("value",t.reviewData.latitude||"N/A"),p(4),h("value",t.reviewData.longitude||"N/A"),p(5),b("ngModel",t.reviewData.name),p(2),b("ngModel",t.reviewData.address),p(2),b("ngModel",t.reviewData.category),p(15),h("label",A("Calificaci\xF3n (Rating): ",t.reviewData.rating," estrellas")),b("ngModel",t.reviewData.rating),p(4),b("ngModel",t.reviewData.comment),p(5),h("disabled",t.isLoading),p(3),h("ngIf",t.photoPath),p(),h("ngIf",t.errorMessage),p(2),h("disabled",!t.isFormValid()||t.isLoading),p(),h("ngIf",t.isLoading),p(),h("ngIf",!t.isLoading))},dependencies:[ve,Y,Z,$,ee,te,ie,ne,ae,oe,re,le,se,ce,de,me,pe,ue,ge,K,Q,X,he,W,N,J,H,B,j,z,V,G],styles:['@charset "UTF-8";ion-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--ion-color-primary);color:var(--ion-color-primary-contrast)}ion-content[_ngcontent-%COMP%]{--background: #f4f5f8}ion-card[_ngcontent-%COMP%]{box-shadow:0 4px 12px #00000014;border-radius:12px;margin:16px 0}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:0}ion-item.modern-input[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0;--min-height: 48px}ion-item.modern-input[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-item.modern-input[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;color:var(--ion-color-dark)}.rating-slider-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:10px 0}.rating-display[_ngcontent-%COMP%]{text-align:center;font-size:1.1em;margin-top:10px}.rating-display[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--ion-color-warning);font-size:1.2em}.submit-button[_ngcontent-%COMP%]{margin-top:25px;height:50px;font-weight:700;--border-radius: 10px}.success-text[_ngcontent-%COMP%]{margin-top:5px;color:var(--ion-color-secondary);font-size:.8em;text-align:center}.preview-image[_ngcontent-%COMP%]{width:100%;max-height:200px;object-fit:cover;border-radius:8px;margin-top:10px;border:1px solid var(--ion-color-medium-tint)}ion-button[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{margin-right:5px}']});let o=n;return o})();export{mt as CreateReviewPage};
