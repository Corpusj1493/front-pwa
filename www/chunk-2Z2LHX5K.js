import{a as le,b as ce}from"./chunk-GPOJ6U7F.js";import{A as te,B as ie,C as ne,D as ae,E as oe,K as re,a as j,c as O,e as H,f as z,g as J,h as q,i as G,j as K,k as Q,l as U,m as X,q as Y,r as Z,t as $,v as ee}from"./chunk-NZTSZEPZ.js";import"./chunk-DBLGMTO4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-O52IKJVK.js";import"./chunk-OQJCXMAZ.js";import"./chunk-VL6F45B6.js";import"./chunk-EU7FQ5IA.js";import"./chunk-STP2TL6J.js";import"./chunk-TCRGSDKV.js";import"./chunk-7FY2OE2O.js";import"./chunk-VBVQFYTF.js";import"./chunk-5EGKW7JY.js";import"./chunk-DM6TJFWJ.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-D7QNDGRV.js";import"./chunk-CKP3SGE2.js";import"./chunk-3IBBKVJY.js";import"./chunk-DADNZVRM.js";import{A as v,Ba as M,Ca as T,Ea as V,Fa as F,Ga as B,H as n,L as _,La as L,N as R,Qa as A,R as g,W as d,X as e,Y as i,Z as x,da as y,ea as D,fa as m,g as P,l as b,ma as a,na as f,oa as p,pa as E,qa as h,qb as k,ra as I,sa as w,tb as N,wa as S,ya as C,z as u,zb as W}from"./chunk-3YJH32OC.js";import"./chunk-Z6NEOT2M.js";import"./chunk-MSMJJC2X.js";import"./chunk-53OGNGEH.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-REYR55MP.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import"./chunk-JHI3MBHO.js";function se(o,c){o&1&&(e(0,"div",6),x(1,"ion-spinner"),e(2,"p"),a(3,"Cargando detalles..."),i()())}function de(o,c){if(o&1&&(e(0,"span"),a(1),S(2,"number"),i()),o&2){let t=m(2);n(),E(" ",C(2,2,t.averageRating,"1.1-1")," / 5 (",t.reviews.length," rese\xF1as/votos) ")}}function me(o,c){o&1&&(e(0,"span"),a(1," A\xFAn no hay votos. "),i())}function pe(o,c){if(o&1&&(e(0,"h3"),a(1),i()),o&2){let t=m().$implicit;n(),p('Comentario: "',t.comment,'"')}}function ge(o,c){if(o&1&&(e(0,"ion-card")(1,"ion-card-content"),g(2,pe,2,1,"h3",5),e(3,"p"),a(4),i(),e(5,"p"),a(6),i(),e(7,"p")(8,"small"),a(9),S(10,"date"),i()()()()),o&2){let t=c.$implicit;n(2),d("ngIf",t.comment),n(2),p("\u2B50 **Rating:** ",t.rating," / 5"),n(2),p("Por: **",(t.user==null?null:t.user.name)||"An\xF3nimo","**"),n(3),p("Publicado: ",C(10,4,t.created_at,"mediumDate"))}}function ue(o,c){o&1&&(e(0,"ion-item")(1,"ion-label"),a(2,"S\xE9 el primero en dejar un voto o comentario."),i()())}function ve(o,c){if(o&1){let t=y();e(0,"div")(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),a(4),i(),e(5,"ion-card-subtitle"),a(6),i()(),e(7,"ion-card-content")(8,"h2",7),a(9," Votaci\xF3n Promedio: "),g(10,de,3,5,"span",5)(11,me,2,0,"span",5),i()()(),e(12,"ion-card",8)(13,"ion-card-header")(14,"ion-card-title"),a(15,"\xA1Deja tu Voto y Comentario!"),i()(),e(16,"ion-card-content")(17,"ion-item")(18,"ion-label",9),a(19,"Votaci\xF3n (1-5)"),i(),e(20,"ion-range",10),w("ngModelChange",function(r){u(t);let s=m();return I(s.newRating,r)||(s.newRating=r),v(r)}),e(21,"ion-label",1),a(22,"1"),i(),e(23,"ion-label",11),a(24,"5"),i()()(),e(25,"p",7),a(26,"Tu Voto: "),e(27,"strong"),a(28),i()(),e(29,"ion-item",8)(30,"ion-label",9),a(31,"Comentario (Opcional)"),i(),e(32,"ion-textarea",12),w("ngModelChange",function(r){u(t);let s=m();return I(s.newComment,r)||(s.newComment=r),v(r)}),i()(),e(33,"ion-button",13),D("click",function(){u(t);let r=m();return v(r.submitReview())}),a(34," Enviar Voto y Comentario "),i()()(),e(35,"ion-list-header")(36,"ion-label"),a(37),i()(),g(38,ge,11,7,"ion-card",14)(39,ue,3,0,"ion-item",5),i()}if(o&2){let t=m();n(4),f(t.placeDetail.name),n(2),p(" Direcci\xF3n: ",t.placeDetail.address||"No disponible"," "),n(4),d("ngIf",t.averageRating!==null),n(),d("ngIf",t.averageRating===null),n(9),h("ngModel",t.newRating),n(8),f(t.newRating),n(4),h("ngModel",t.newComment),n(),d("disabled",t.isLoading),n(4),p("Todos los Comentarios (",t.reviews.length,")"),n(),d("ngForOf",t.reviews),n(),d("ngIf",t.reviews.length===0)}}var Ee=(()=>{let c=class c{constructor(l,r,s){this.route=l,this.placeService=r,this.reviewService=s,this.placeDetail=null,this.reviews=[],this.isLoading=!1,this.averageRating=null,this.newComment="",this.newRating=5}ngOnInit(){this.placeId=Number(this.route.snapshot.paramMap.get("id")),this.placeId&&this.loadPlaceDetails()}loadPlaceDetails(){this.isLoading=!0,P({place:this.placeService.getPlaceById(this.placeId),reviewsResponse:this.reviewService.getReviewsByPlaceId(this.placeId)}).pipe(b(()=>this.isLoading=!1)).subscribe({next:l=>{l.place&&(this.placeDetail=l.place),l.reviewsResponse.success&&l.reviewsResponse.data&&(this.reviews=l.reviewsResponse.data),this.calculateAverageRating()},error:l=>console.error("Error al cargar detalles:",l)})}calculateAverageRating(){if(this.reviews.length>0){let l=this.reviews.reduce((r,s)=>r+s.rating,0);this.averageRating=l/this.reviews.length}else this.averageRating=null}submitReview(){if(!this.placeId||this.newRating<1||this.newRating>5){console.error("ID de lugar o rating inv\xE1lido.");return}let l={place_id:this.placeId,rating:this.newRating,comment:this.newComment||null};this.reviewService.createReview(l).subscribe({next:()=>{console.log("Rese\xF1a (Voto y Comentario) enviada con \xE9xito."),this.newComment="",this.loadPlaceDetails()},error:r=>console.error("Error al enviar rese\xF1a:",r)})}};c.\u0275fac=function(r){return new(r||c)(_(L),_(ce),_(le))},c.\u0275cmp=R({type:c,selectors:[["app-place-detail"]],decls:9,vars:5,consts:[[3,"translucent"],["slot","start"],["defaultHref","/tabs/tab1"],[3,"fullscreen"],["class","ion-text-center ion-padding",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],[1,"ion-text-center"],[1,"ion-margin-top"],["position","floating"],["min","1","max","5","step","1","color","primary",3,"ngModelChange","ngModel"],["slot","end"],[3,"ngModelChange","ngModel"],["expand","block",1,"ion-margin-top",3,"click","disabled"],[4,"ngFor","ngForOf"]],template:function(r,s){r&1&&(e(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),x(3,"ion-back-button",2),i(),e(4,"ion-title"),a(5),i()()(),e(6,"ion-content",3),g(7,se,4,0,"div",4)(8,ve,40,11,"div",5),i()),r&2&&(d("translucent",!0),n(5),f((s.placeDetail==null?null:s.placeDetail.name)||"Cargando Lugar..."),n(),d("fullscreen",!0),n(),d("ngIf",s.isLoading),n(),d("ngIf",s.placeDetail))},dependencies:[re,H,z,J,q,G,K,Q,U,X,Y,Z,$,ee,te,ie,ne,ae,j,O,oe,B,M,T,W,k,N,A,F,V],encapsulation:2});let o=c;return o})();export{Ee as PlaceDetailPage};
